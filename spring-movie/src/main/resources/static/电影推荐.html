<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>电影推荐</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#E50914',
            secondary: '#0F172A',
            accent: '#F59E0B',
            neutral: '#1E293B',
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .film-grain {
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
      }
      .btn-hover {
        @apply hover:shadow-lg hover:shadow-primary/20 hover:-translate-y-0.5 transition-all duration-300;
      }
    }
  </style>
</head>
<body class="bg-secondary text-gray-100 min-h-screen font-sans film-grain">
  <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
    <div class="absolute -top-40 -right-40 w-96 h-96 bg-primary/20 rounded-full blur-3xl"></div>
    <div class="absolute top-1/3 -left-20 w-72 h-72 bg-accent/10 rounded-full blur-3xl"></div>
    <div class="absolute bottom-10 right-1/4 w-64 h-64 bg-primary/10 rounded-full blur-3xl"></div>
  </div>

  <div class="relative z-10 min-h-screen flex flex-col">
    <header class="container mx-auto px-4 py-8">
      <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
        <div class="flex items-center gap-4">
          <span class="flex h-14 w-14 items-center justify-center rounded-2xl bg-primary/20 text-primary text-2xl shadow-lg">
            <i class="fa fa-film"></i>
          </span>
          <div>
            <p class="text-sm text-gray-400">欢迎回来，<span id="welcome-name" class="text-white font-semibold">影迷</span></p>
            <h1 class="text-3xl font-bold text-white flex items-center gap-2">
              今日电影推荐
              <span class="px-3 py-1 text-xs font-medium rounded-full bg-primary/10 text-primary border border-primary/40">智能精选</span>
            </h1>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <button class="hidden md:inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-700 bg-neutral/80 text-gray-200 hover:border-primary hover:text-primary transition">
            <i class="fa fa-random"></i>
            <span>换一批</span>
          </button>
          <button id="logout-btn" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white hover:bg-primary/90 transition btn-hover">
            <i class="fa fa-sign-out"></i>
            <span>退出登录</span>
          </button>
        </div>
      </div>
      <div id="mood-tags" class="mt-6 flex flex-wrap gap-3 text-sm"></div>
    </header>

    <main class="container mx-auto px-4 pb-16 space-y-10 flex-1">
      <section class="bg-neutral/80 border border-gray-800 rounded-3xl overflow-hidden backdrop-blur-sm shadow-2xl">
        <div class="p-8 space-y-6">
          <div class="inline-flex items-center gap-2 text-sm text-primary">
            <i class="fa fa-bolt"></i>
            <span>今日焦点</span>
          </div>
          <div id="spotlight-content" class="grid gap-8 lg:grid-cols-[1.1fr_1.9fr] items-center"></div>
        </div>
      </section>

      <section>
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
          <div>
            <h2 class="text-2xl font-semibold text-white">为你量身推荐</h2>
            <p class="text-sm text-gray-400 mt-1">根据你的观影偏好智能推荐，涵盖不同心情与场景</p>
          </div>
          <button class="inline-flex items-center gap-2 text-sm text-gray-300 hover:text-primary transition">
            <i class="fa fa-sliders"></i>
            <span>筛选偏好</span>
          </button>
        </div>
        <div id="recommend-list" class="grid gap-6 md:grid-cols-2 xl:grid-cols-3"></div>
      </section>
    </main>
  </div>

  <script>
    (function () {
      const TOKEN_KEY = 'user_token_header';
      const USERNAME_KEY = 'username';
      const FALLBACK_POSTER = 'https://images.unsplash.com/photo-1485846234645-a62644f84728?auto=format&fit=crop&w=700&q=80';

      const token = localStorage.getItem(TOKEN_KEY);
      if (!token) {
        window.location.replace('首页.html');
        return;
      }

      const welcomeNameElement = document.getElementById('welcome-name');
      const username = localStorage.getItem(USERNAME_KEY) || '影迷';
      if (welcomeNameElement) {
        welcomeNameElement.textContent = username;
      }

      const logoutButton = document.getElementById('logout-btn');
      if (logoutButton) {
        logoutButton.addEventListener('click', () => {
          localStorage.removeItem(TOKEN_KEY);
          localStorage.removeItem(USERNAME_KEY);
          window.location.href = '首页.html';
        });
      }

      const moodTags = ['烧脑悬疑', '暖心治愈', '动作爽片', '家庭欢聚', '音乐励志', '动画精选'];
      const moodTagsContainer = document.getElementById('mood-tags');
      if (moodTagsContainer) {
        moodTags.forEach((tag) => {
          const tagElement = document.createElement('span');
          tagElement.className = 'px-4 py-1.5 rounded-full border border-gray-700 bg-neutral/80 text-gray-300 hover:border-primary hover:text-primary transition cursor-pointer';
          tagElement.textContent = tag;
          moodTagsContainer.appendChild(tagElement);
        });
      }

      const recommendations = [
        {
          title: '无间道',
          originalTitle: 'Infernal Affairs',
          year: 2002,
          rating: 9.3,
          runtime: 101,
          genres: ['犯罪', '剧情', '悬疑'],
          director: '刘伟强 / 麦兆辉',
          description: '警匪对峙间的人性博弈，层层反转的剧情让人屏息以待。双雄殊途同归，善恶一线之间。',
          poster: 'https://images.unsplash.com/photo-1517604931442-7e0c8ed2963c?auto=format&fit=crop&w=600&q=80',
          highlight: '双雄对决的极致心理博弈',
          featured: true
        },
        {
          title: '星际穿越',
          originalTitle: 'Interstellar',
          year: 2014,
          rating: 9.4,
          runtime: 169,
          genres: ['科幻', '冒险', '剧情'],
          director: '克里斯托弗·诺兰',
          description: '穿越虫洞的星际旅程，宇宙与亲情交织出宏大的情感史诗，陪你探索未知的边界。'
        },
        {
          title: '霸王别姬',
          originalTitle: 'Farewell My Concubine',
          year: 1993,
          rating: 9.6,
          runtime: 171,
          genres: ['剧情', '爱情'],
          director: '陈凯歌',
          description: '半生浮沉的梨园传奇，戏里戏外都是情。一个时代的缩影，一曲绵长的离歌。'
        },
        {
          title: '疯狂的石头',
          originalTitle: 'Crazy Stone',
          year: 2006,
          rating: 8.6,
          runtime: 106,
          genres: ['喜剧', '犯罪'],
          director: '宁浩',
          description: '笑料与反转齐飞，层层设局的盗宝计划让人捧腹。轻松解压的同时也充满巧思。'
        },
        {
          title: '寻梦环游记',
          originalTitle: 'Coco',
          year: 2017,
          rating: 9.1,
          runtime: 105,
          genres: ['动画', '冒险', '音乐'],
          director: '李·昂克里奇',
          description: '跨越生死的温暖旅程，用音乐连接家庭与梦想，适合全家一起感受感动与快乐。'
        },
        {
          title: '你的名字。',
          originalTitle: 'Your Name',
          year: 2016,
          rating: 8.5,
          runtime: 112,
          genres: ['动画', '爱情', '奇幻'],
          director: '新海诚',
          description: '命运交错的青春恋曲，唯美画面与动人配乐让人沉浸于浪漫幻想之中。'
        }
      ];

      const spotlightContainer = document.getElementById('spotlight-content');
      const recommendList = document.getElementById('recommend-list');

      const renderSpotlight = (movie) => {
        if (!spotlightContainer || !movie) return;
        const genresText = Array.isArray(movie.genres) ? movie.genres.join(' / ') : '';
        spotlightContainer.innerHTML = `
          <div class="grid gap-8 lg:grid-cols-[1.1fr_1.9fr] items-center">
            <div class="group relative overflow-hidden rounded-3xl border border-gray-800 shadow-2xl aspect-[2/3]">
              <img src="${movie.poster || FALLBACK_POSTER}" alt="${movie.title} 海报" data-role="poster" class="h-full w-full object-cover transition-transform duration-700 group-hover:scale-105" />
              <div class="absolute inset-0 bg-gradient-to-t from-secondary via-secondary/40 to-transparent"></div>
              <div class="absolute bottom-0 left-0 right-0 p-5 space-y-2">
                <span class="inline-flex items-center gap-2 text-sm text-gray-300">
                  <i class="fa fa-bolt text-primary"></i>
                  ${movie.highlight || '高分口碑必看'}
                </span>
                <h3 class="text-2xl font-semibold text-white">${movie.title}</h3>
                <p class="text-sm text-gray-300">${movie.year} · ${movie.runtime} 分钟 · ${genresText}</p>
              </div>
            </div>
            <div class="space-y-5">
              <div class="flex items-center gap-3">
                <span class="inline-flex items-center gap-2 rounded-full bg-primary/10 px-4 py-1 text-primary font-semibold">
                  <i class="fa fa-star"></i>
                  <span>${Number(movie.rating || 0).toFixed(1)}</span>
                </span>
                <span class="text-sm text-gray-400">豆瓣高分佳作</span>
              </div>
              <h2 class="text-3xl font-bold text-white">${movie.title}</h2>
              <p class="text-lg leading-relaxed text-gray-300">${movie.description}</p>
              <div class="flex flex-wrap gap-3 text-sm text-gray-400">
                <span>导演：${movie.director}</span>
                ${movie.originalTitle ? `<span>原名：${movie.originalTitle}</span>` : ''}
              </div>
              <div class="flex items-center gap-3">
                <button class="px-5 py-2 rounded-lg bg-primary text-white hover:bg-primary/90 transition btn-hover">
                  <i class="fa fa-play"></i>
                  <span>立即观看</span>
                </button>
                <button class="px-5 py-2 rounded-lg border border-gray-700 text-gray-200 hover:border-primary hover:text-primary transition">
                  <i class="fa fa-plus"></i>
                  <span>加入片单</span>
                </button>
              </div>
            </div>
          </div>
        `;

        const posterElement = spotlightContainer.querySelector('img[data-role="poster"]');
        if (posterElement) {
          posterElement.addEventListener('error', () => {
            posterElement.src = FALLBACK_POSTER;
          }, { once: true });
        }
      };

      const renderRecommendations = (movies) => {
        if (!recommendList) return;
        recommendList.innerHTML = '';
        movies.forEach((movie, index) => {
          if (movie.featured) {
            return;
          }
          const card = document.createElement('article');
          card.className = 'group bg-neutral/80 border border-gray-800 rounded-2xl p-6 flex flex-col h-full backdrop-blur-sm shadow-lg transition-all hover:-translate-y-1 hover:border-primary/60 hover:shadow-primary/20';
          const rankBadge = `<span class="flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-primary/15 text-primary font-semibold">${String(index + 1).padStart(2, '0')}</span>`;
          const genreTags = Array.isArray(movie.genres)
            ? movie.genres.map((genre) => `<span class="rounded-full bg-gray-900/60 border border-gray-700 px-3 py-1">${genre}</span>`).join('')
            : '';
          const ratingText = Number(movie.rating || 0).toFixed(1);

          card.innerHTML = `
            <div class="flex items-start justify-between gap-4">
              <div class="flex items-start gap-4">
                ${rankBadge}
                <div>
                  <h3 class="text-xl font-semibold text-white group-hover:text-primary transition-colors">${movie.title}</h3>
                  <p class="mt-1 text-sm text-gray-400">${movie.year} · ${(Array.isArray(movie.genres) ? movie.genres.join(' / ') : '')}</p>
                </div>
              </div>
              <div class="flex flex-col items-end text-primary">
                <span class="flex items-center gap-1 text-lg font-semibold">
                  <i class="fa fa-star"></i>
                  ${ratingText}
                </span>
                <span class="mt-1 text-xs text-gray-400">观众口碑</span>
              </div>
            </div>
            <p class="mt-4 text-gray-300 leading-relaxed flex-1">${movie.description}</p>
            <div class="mt-6 flex flex-wrap gap-2 text-xs text-gray-300">${genreTags}</div>
            <div class="mt-6 flex items-center justify-between text-sm text-gray-400">
              <span>导演：${movie.director}</span>
              <span>${movie.runtime} 分钟</span>
            </div>
            <button class="mt-6 inline-flex items-center justify-center gap-2 rounded-lg border border-gray-700 px-4 py-2 text-gray-200 transition hover:border-primary hover:text-primary">
              <i class="fa fa-play-circle"></i>
              <span>了解详情</span>
            </button>
          `;

          recommendList.appendChild(card);
        });
      };

      const spotlightMovie = recommendations.find((movie) => movie.featured) || recommendations[0];
      renderSpotlight(spotlightMovie);
      renderRecommendations(recommendations);
    })();
  </script>
</body>
</html>
